<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Session &#8212; OmMongo 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
     
    
    <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">
    
    

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OmMongo 0.1 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-ommongo.session">
<span id="session"></span><h1>Session<a class="headerlink" href="#module-ommongo.session" title="Permalink to this headline">¶</a></h1>
<p>Session objects handles the actual queueing of database operations.
The primary methods on a session are query, save, and flush.</p>
<p>The session also responsible for ordering operations and knowing when
operations need to be flushed, although it does not currently do
anything intelligent for ordering.</p>
<dl class="class">
<dt id="ommongo.session.Session">
<em class="property">class </em><code class="descclassname">ommongo.session.</code><code class="descname">Session</code><span class="sig-paren">(</span><em>database</em>, <em>tz_aware=False</em>, <em>timezone=None</em>, <em>safe=False</em>, <em>cache_size=0</em>, <em>auto_ensure=True</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a session connecting to <cite>database</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>database</strong> &#8211; the database to connect to.  Should be an instance of             <code class="xref py py-class docutils literal"><span class="pre">pymongo.database.Database</span></code></li>
<li><strong>safe</strong> &#8211; Whether the &#8220;safe&#8221; option should be used on mongo writes,             blocking to make sure there are no errors.</li>
<li><strong>auto_ensure</strong> &#8211; Whether to implicitly call ensure_indexes on all write             operations.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt><strong>Fields</strong>:</dt>
<dd><ul class="first last simple">
<li>db: the underlying pymongo database object</li>
<li>queue: the queue of unflushed database commands (currently useless                 since there aren&#8217;t any operations which defer flushing)</li>
<li>cache_size: The size of the identity map to keep.  When objects                             are pulled from the DB they are checked against this                             map and if present, the existing object is used.                              Defaults to 0, use None to only clear at session end.</li>
</ul>
</dd>
</dl>
<dl class="classmethod">
<dt id="ommongo.session.Session.connect">
<em class="property">classmethod </em><code class="descname">connect</code><span class="sig-paren">(</span><em>database</em>, <em>timezone=None</em>, <em>cache_size=0</em>, <em>auto_ensure=True</em>, <em>replica_set=None</em>, <em>*args</em>, <em>**kwds</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.connect"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.connect" title="Permalink to this definition">¶</a></dt>
<dd><p><cite>connect</cite> is a thin wrapper around __init__ which creates the
database connection that the session will use.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>database</strong> &#8211; the database name to use.  Should be an instance of                     <code class="xref py py-class docutils literal"><span class="pre">basestring</span></code></li>
<li><strong>safe</strong> &#8211; The value for the &#8220;safe&#8221; parameter of the Session                 init function</li>
<li><strong>auto_ensure</strong> &#8211; Whether to implicitly call ensure_indexes on all write                 operations.</li>
<li><strong>replica_set</strong> &#8211; The replica-set to use (as a string). If specified,                 <code class="xref py py-class docutils literal"><span class="pre">pymongo.mongo_replica_set_client.MongoReplicaSetClient</span></code> is used                 instead of <code class="xref py py-class docutils literal"><span class="pre">pymongo.mongo_client.MongoClient</span></code></li>
<li><strong>args</strong> &#8211; arguments for <code class="xref py py-class docutils literal"><span class="pre">pymongo.mongo_client.MongoClient</span></code></li>
<li><strong>kwds</strong> &#8211; keyword arguments for <code class="xref py py-class docutils literal"><span class="pre">pymongo.mongo_client.MongoClient</span></code></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.end">
<code class="descname">end</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.end"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.end" title="Permalink to this definition">¶</a></dt>
<dd><p>End the session.  Flush all pending operations and ending the
<em>pymongo</em> request</p>
</dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.insert">
<code class="descname">insert</code><span class="sig-paren">(</span><em>item</em>, <em>safe=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.insert"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.insert" title="Permalink to this definition">¶</a></dt>
<dd><p>[DEPRECATED] Please use save() instead. This actually calls
the underlying save function, so the name is confusing.</p>
<p>Insert an item into the work queue and flushes.</p>
</dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.save">
<code class="descname">save</code><span class="sig-paren">(</span><em>item</em>, <em>safe=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves an item into the work queue and flushes.</p>
</dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.add">
<code class="descname">add</code><span class="sig-paren">(</span><em>item</em>, <em>safe=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.add"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add an item into the queue of things to be inserted.  Does not flush.</p>
</dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.update">
<code class="descname">update</code><span class="sig-paren">(</span><em>item</em>, <em>id_expression=None</em>, <em>upsert=False</em>, <em>update_ops={}</em>, <em>safe=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.update"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update an item in the database.  Uses the on_update keyword to each
field to decide which operations to do, or.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>item</strong> &#8211; An instance of a <a class="reference internal" href="../../api/schema/document.html#ommongo.document.Document" title="ommongo.document.Document"><code class="xref py py-class docutils literal"><span class="pre">Document</span></code></a>                 subclass</li>
<li><strong>id_expression</strong> &#8211; A query expression that uniquely picks out                 the item which should be updated.  If id_expression is not                 passed, update uses item.mongo_id.</li>
<li><strong>upsert</strong> &#8211; Whether the update operation should be an upsert.                 If the item may not be in the database yet this should be True</li>
<li><strong>update_ops</strong> &#8211; By default the operation used to update a field                 is specified with the on_update argument to its constructor.                 To override that value, use this dictionary, with                  <code class="xref py py-class docutils literal"><span class="pre">QueryField</span></code> objects as the keys                 and the mongo operation to use as the values.</li>
<li><strong>kwargs</strong> &#8211; The kwargs are merged into update_ops dict to                 decide which fields to update the operation for.  These can                 only be for the top-level document since the keys                 are just strings.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This operation is <strong>experimental</strong> and <strong>not fully tested</strong>,
although it does have code coverage.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.query">
<code class="descname">query</code><span class="sig-paren">(</span><em>type</em>, <em>exclude_subclasses=False</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.query" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Begin a query on the database&#8217;s collection for <cite>type</cite>.  If <cite>type</cite></dt>
<dd>is an instance of basesting, the query will be in raw query mode
which will not check field values or transform returned results
into python objects.</dd>
</dl>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../../api/expressions/query.html#ommongo.query.Query" title="ommongo.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a> class</p>
</div>
</dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.add_to_session">
<code class="descname">add_to_session</code><span class="sig-paren">(</span><em>obj</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.add_to_session"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.add_to_session" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.execute_query">
<code class="descname">execute_query</code><span class="sig-paren">(</span><em>query</em>, <em>session</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.execute_query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.execute_query" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the results of <code class="docutils literal"><span class="pre">query</span></code>.  This method does flush in a
transaction, so any objects retrieved which are not in the cache
which would be updated when the transaction finishes will be
stale</p>
</dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.remove_query">
<code class="descname">remove_query</code><span class="sig-paren">(</span><em>type</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.remove_query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.remove_query" title="Permalink to this definition">¶</a></dt>
<dd><p>Begin a remove query on the database&#8217;s collection for <cite>type</cite>.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><code class="xref py py-class docutils literal"><span class="pre">RemoveQuery</span></code> class</p>
</div>
</dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.remove">
<code class="descname">remove</code><span class="sig-paren">(</span><em>obj</em>, <em>safe=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.remove"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a particular object from the database.  If the object has
no mongo ID set, the method just returns.  If this is a partial
document without the mongo ID field retrieved a <code class="docutils literal"><span class="pre">FieldNotRetrieved</span></code>
will be raised</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>obj</strong> &#8211; the object to save</li>
<li><strong>safe</strong> &#8211; whether to wait for the operation to complete.  Defaults                 to the session&#8217;s <code class="docutils literal"><span class="pre">safe</span></code> value.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.get_indexes">
<code class="descname">get_indexes</code><span class="sig-paren">(</span><em>cls</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.get_indexes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.get_indexes" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the index information for the collection associated with
<cite>cls</cite>.  Index information is returned in the same format as <em>pymongo</em>.</p>
</dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.ensure_indexes">
<code class="descname">ensure_indexes</code><span class="sig-paren">(</span><em>cls</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.ensure_indexes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.ensure_indexes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.auto_ensure_indexes">
<code class="descname">auto_ensure_indexes</code><span class="sig-paren">(</span><em>cls</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.auto_ensure_indexes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.auto_ensure_indexes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.clear_queue">
<code class="descname">clear_queue</code><span class="sig-paren">(</span><em>trans_id=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.clear_queue"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.clear_queue" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear the queue of database operations without executing any of
the pending operations</p>
</dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.clear_cache">
<code class="descname">clear_cache</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.clear_cache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.clear_cache" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.clear_collection">
<code class="descname">clear_collection</code><span class="sig-paren">(</span><em>*classes</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.clear_collection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.clear_collection" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear all objects from the collections associated with the
objects in <cite>*cls</cite>. <strong>use with caution!</strong></p>
</dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.flush">
<code class="descname">flush</code><span class="sig-paren">(</span><em>safe=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.flush"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.flush" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform all database operations currently in the queue</p>
</dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.dereference">
<code class="descname">dereference</code><span class="sig-paren">(</span><em>ref</em>, <em>allow_none=False</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.dereference"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.dereference" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.refresh">
<code class="descname">refresh</code><span class="sig-paren">(</span><em>document</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.refresh"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.refresh" title="Permalink to this definition">¶</a></dt>
<dd><p>Load a new copy of a document from the database.  does not
replace the old one</p>
</dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.clone">
<code class="descname">clone</code><span class="sig-paren">(</span><em>document</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.clone"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.clone" title="Permalink to this definition">¶</a></dt>
<dd><p>Serialize a document, remove its _id, and deserialize as a new
object</p>
</dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.begin_trans">
<code class="descname">begin_trans</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.begin_trans"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.begin_trans" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ommongo.session.Session.end_trans">
<code class="descname">end_trans</code><span class="sig-paren">(</span><em>exc_type=None</em>, <em>exc_val=None</em>, <em>exc_tb=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/ommongo/session.html#Session.end_trans"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ommongo.session.Session.end_trans" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/api/session.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    

    
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Bapakode Open Source.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.3.
    </div>
    

  </body>
</html>